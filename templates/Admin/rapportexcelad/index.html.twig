{% extends 'Admin/statistique_ad/basead.html.twig' %}
{% block title %}Rapport excel{% endblock %}
  {% block stylesheets %}
  <link href="{{asset('img/favicon.png')}}" rel="icon">
  <link href="{{asset('img/apple-touch-icon.png')}}" rel="apple-touch-icon">
 
  <!-- Bootstrap core CSS -->
  <link href="{{asset('lib/bootstrap/css/bootstrap.min.css')}}" rel="stylesheet">
  <!--external css-->
  <link href="{{asset('lib/font-awesome/css/font-awesome.css')}}" rel="stylesheet" >
  <link href="{{asset('lib/advanced-datatable/css/demo_page.css')}}" rel="stylesheet" >
  <link href="{{asset('lib/advanced-datatable/css/demo_table.css')}}" rel="stylesheet" >
  <link rel="stylesheet" href="{{asset('lib/advanced-datatable/css/DT_bootstrap.css')}}" >
  <!-- Custom styles for this template -->
  <link href="{{asset('css/style.css')}}" rel="stylesheet">
  <link href="{{asset('css/style-responsive.css')}}" rel="stylesheet">
   <link href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
   
 <link href="https://cdn.datatables.net/responsive/2.2.7/css/responsive.dataTables.min.css">
 <link href="https://cdn.datatables.net/buttons/1.7.0/css/buttons.dataTables.min.css">

    <link rel="stylesheet" type="text/css" href="lib/bootstrap-datepicker/css/datepicker.css" />
 <link rel="stylesheet" type="text/css" href="lib/bootstrap-datetimepicker/datertimepicker.css" />
 
 {% endblock %}

{% block body %}
  <div class="showback" style="width: 700px;margin-left: 221px;margin-top: 54px;">
    <label> Date de début:</label><input type="date"    id="txtMin"  />
    <label> Date de fin :</label> <input type="date"   id="txtMax"  />
    <button id="btnGo" type="button" style="margin-left:13px;" class="btn btn-theme">Filtre </button>
        <button id="reset" type="reset"  style="margin-left:3px;" class="btn btn-warning">Rafraîchir</button>

  </div>
        <div class="row mb" style="margin-left:10px;margin-right:10px;margin-top:33px;">
          <!-- page start-->
     
          <div class="content-panel"cellspacing="50" style="height:555px;">
          
            <div class="adv-table">
              <table cellpadding="0" cellspacing="0" border="0" class="display  table  table-bordered" id="example">
                <thead>
                  <tr>
                  <th class="thnomprenom">Nom Prenom</th> 
                    <th class="thnomprenom">Société</th>
                    <th class="thnomprenom" >Date</th>
                    <th class="thnomprenom" >Durée du travail</th>
                    <th class="thnomprenom">Temps de retard</th>
                    
                  </tr>
                </thead>
                    <tfoot  style="display:table-header-group;">
            <tr> 
                 <th>Nom Prenom</th> 
                    <th class="center hidden-phone">société</th>
                    <th class="center hidden-phone" >Date</th>
                    <th class="center hidden-phone" >Temps de travail</th>
                    <th class="center hidden-phone" >Temps de retard</th>
                    
            </tr>
        </tfoot>
                <tbody>
                 {% for liste in infoemp%}
                 {% for emp in liste['employe']%}
                 {%if  emp.societe ==liste['idsociete'] %}
                {% for date in listedate %}
                 {%if  date['id'] ==emp.idemp %}
                       {% for heures in date['liste']|reverse%}
                        {% for infoheure in liste['heur']%}
                        {%if  (infoheure['id'] ==emp.idemp) and (infoheure['date']== heures) %}
                       
                       
                  <tr class="gradeX">
                  
                    
                    <td class="center hidden-phone">{{emp.nom}}</td>
                    
                     
                    <td class="tdcomon">{{liste['nomsociete']}}</td>
                  <td class="tdcomon">{{heures}}</td>
                    <td class="tdcomon">{{infoheure['heuretravail']}}</td>
                    <td class="tdtime">{{infoheure['heureretard']}}</td>
                    
                     
                     
                  </tr>
                  
                  
                 
                 
                  {%endif%}
                    {%endfor%}
                   {%endfor%}
                {%endif%}
                  {%endfor%}
                 {%endif%}
                  {%endfor%}
                   {%endfor%}
                   
                  
                 
                
                
                
                  
                 
                
                </tbody>
            
              </table>
            </div>
          </div>
          <!-- page end-->
        </div>
        <!-- /row -->
     
      <!-- /wrapper -->
 {% block javascripts %}
  <!-- js placed at the end of the document so the pages load faster -->
   <script type="text/javascript" language="javascript" src="{{asset('lib/advanced-datatable/js/jquery.js')}}"></script>
  
 <script class="include" type="text/javascript" src="{{asset('lib/jquery.dcjqaccordion.2.7.js')}}"></script>
  <script src="{{asset('lib/jquery.scrollTo.min.js')}}"></script>
   <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
  <script src="{{asset('lib/jquery.nicescroll.js')}}" type="text/javascript"></script>
  <script type="text/javascript" language="javascript" src="{{asset('lib/advanced-datatable/js/jquery.dataTables.js')}}"></script>
  <script type="text/javascript" src="{{asset('lib/advanced-datatable/js/DT_bootstrap.js')}}"></script>
   
   <script   src="https://cdn.datatables.net/buttons/1.7.0/js/dataTables.buttons.min.js"></script>
   <script  src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script   src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script   src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script  src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.html5.min.js"></script>
<script   src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.colVis.min.js"> </script>
    <script src="https://nightly.datatables.net/buttons/js/dataTables.buttons.js?_=c6b24f8a56e04fcee6105a02f4027462"></script>
    <script src="https://nightly.datatables.net/buttons/js/buttons.colVis.js?_=c6b24f8a56e04fcee6105a02f4027462"></script>

   
<!-- pour filtre min et max date -->
    <link href="https://nightly.datatables.net/css/jquery.dataTables.css" rel="stylesheet" type="text/css" />
  
        <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.js"></script>

  <!--common script for all pages--> 
 
 
  <!--script for this page-->
  <script type="text/javascript">
    /* Formating function for row details */ 
   
  $.fn.dataTable.ext.search.push(
    function (settings, data, dataIndex) {

          
        var valid = true;
          
    var mint = moment($("#txtMin").val());
                  var time = new Date(mint);    
                  month = (time.getMonth() + 1),
        day =  time.getDate(), 
        year = time.getFullYear();
         if (month.length < 2) month = '0' + month;
    if (day.length < 2) day = '0' + day;
    var mins= [day, month,year].join('/');
    
        var min = moment(mins,"DD/MM/YYYY");

        if (!min.isValid()) { min = null; }
var maxt = moment($("#txtMax").val());
                  var timemax = new Date(maxt);    
                  monthmax = (time.getMonth() + 1),
        daymax =  timemax.getDate(),
        yearmax = timemax.getFullYear();
         if (monthmax.length < 2) monthmax = '0' + monthmax;
    if (daymax.length < 2) daymax = '0' + daymax;
    var maxs= [daymax, monthmax,yearmax].join('/');
    
        var max = moment(maxs,"DD/MM/YYYY");
        
        if (!max.isValid()) { max = null; }

        if (min === null && max === null) {
            // no filter applied or no date columns
            valid = true;
        }
        else {

            $.each(settings.aoColumns, function (i, col) {
              
                if (col.type == "date") {
                    var cDate = moment(data[i],"DD/MM/YYYY");
                
                    if (cDate.isValid()) {
                        if (max !== null && max.isBefore(cDate)) {
                            valid = false;
                        }
                        if (min !== null && cDate.isBefore(min)) {
                            valid = false;
                        }
                    }
                    else {
                        valid = false;
                    }
                }
            });
        }
        return valid;
});
$(document).ready( function () {
   $('#example').dataTable({ 
      
            "bDestroy": true
      }).fnDestroy();

    $("#btnGo").click(function () {
        $('#example').DataTable().draw();
    });
    var currentDate = new Date ();
var day = currentDate.getDate ();
var month = currentDate.getMonth () + 1;
var year = currentDate.getFullYear ();
    if (month.toString().length == 1) month = '0' + month;
    if (day.toString().length == 1) day = '0' + day;
var d = day + "-" + month + "-" + year;
    
      $("#reset").click(function () {
      $("#txtMin").val("");
      $("#txtMax").val("");
        $('#example').DataTable().draw();
    });
  var table=$('#example').DataTable( {
         "language": {
            "lengthMenu": "Afficher_MENU_ enregistrements par page",
            "zeroRecords": "aucun résultat",
            "search": "Recherche",
              "paginate": {
      "previous": "Précédent",
            "next":"Suivant"
    },
            "info": "Afficher la page _PAGE_ of _PAGES_",
            "infoEmpty": "No records available",
           "infoFiltered": "(filtered from _MAX_ total records)"},
           
         
          
       
      columns:[{name:"Nom Prenom"},
                {name:"Societes"},                            
                {name:"Date", type: "date"},
                {name:"heure de travile"},
            
                {name:"heure de retard"}
                ],
                   dom: 'lBfrtip',   
                    
		   
        buttons: [
           
            {
                extend: 'excelHtml5',
                filename: 'rapport'+d,
                exportOptions: {
                    columns: ':visible'
                }
            },
            {
                extend: 'pdfHtml5',
                filename: 'rapport'+d,
                exportOptions: {
                    columns: [ 0, 1, 2,3 ]
                },
                customize: function (doc) {
						
						doc.content.splice(0,1);
						
						var now = new Date();
						var jsDate = now.getDate()+'-'+(now.getMonth()+1)+'-'+now.getFullYear();
						
						doc.pageMargins = [30,20,30,10];
						
						doc.defaultStyle.fontSize = 15;
						
						doc.styles.tableHeader.fontSize = 15;}
            }
        ]
             
                });
   buildSelect( table );
  table.on( 'draw', function () {
    buildSelect( table );
  } );
} );



function buildSelect( table ) {
 
 
  table.columns([0,1,2,3,4,5]).every( function () {
    var column =this;
    var select = $('<select class="selectretrad"><option value=""></option></select>')
    .appendTo( $(column.footer()).empty() )
    .on( 'change', function () {
      var val = $.fn.dataTable.util.escapeRegex(
        $(this).val()
      );

      column
      .search( val ? '^'+val+'$' : '', true, false )
      .draw();
    } );

    column.data().unique().sort().each( function ( d, j ) {
      select.append( '<option value="'+d+'">'+d+'</option>' );
    } );
    
    // The rebuild will clear the exisiting select, so it needs to be repopulated
    var currSearch = column.search();
    if ( currSearch ) {
      select.val( currSearch.substring(1, currSearch.length-1) );
    }
  } );
  $('#example tfoot th').each( function () {
        var title = $(this).text();
  if(title == 'Datee'){
        $(this).html( '<input type="text" placeholder="Search '+title+'" />' );
  } });
 
    // DataTable
    
          
             table.columns().every(function() {
       
            // Apply the search
            
                var that = this;
 
                $( 'input', this.footer() ).on( 'keyup change clear', function () {
                    if ( that.search() !== this.value ) {
                        that
                            .search( this.value )
                            .draw();
                    }
                } );
            } );
   
  
  
}


   
  </script>
  {% endblock %}
{% endblock %}
